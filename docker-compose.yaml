version: '3.8'

services:
  test:
    image: maven:3.9-eclipse-temurin-11
    volumes:
      - .:/app
    working_dir: /app
    # Run only unit tests (no real credentials). Full suite: mvn test with env set.
    command: mvn test -Dtest=ProjectsClientTest,AwsAuthProviderTest

  format:
    image: cimg/openjdk:21.0
    volumes:
      - .:/app
    working_dir: /app
    environment:
      - GOOGLE_JAVA_FORMAT_VERSION=1.30.0
    command: >
      bash -c '
        curl -sSL https://github.com/google/google-java-format/releases/download/v${GOOGLE_JAVA_FORMAT_VERSION}/google-java-format-${GOOGLE_JAVA_FORMAT_VERSION}-all-deps.jar -o /tmp/google-java-format.jar &&
        java -jar /tmp/google-java-format.jar --replace $(find . -type f -name "*.java")
      '
